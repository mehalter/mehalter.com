class: title, no-footer

.two-line[

# Compositional epidemiological modeling <br/> using structured cospans

]

.two-line[

## Micah Halter and Evan Patterson <br/> with James Fairbanks

]

### February 21, 2023

```@setup algpetri
using AlgebraicPetri
using Catlab.Graphics
using Catlab.Theories
using Catlab.Programs
using Catlab, Catlab.CategoricalAlgebra, Catlab.CategoricalAlgebra.FinSets
Catlab.Graphics, Catlab.WiringDiagrams
using Catlab.Graphics.Graphviz: run_graphviz

display_uwd(ex) = to_graphviz(ex, box_labels=:name, junction_labels=:variable, edge_attrs=Dict(:len=>".75"));
display_wd(ex) = to_graphviz(ex, orientation=LeftToRight, labels=true);
save_fig(g, fname::AbstractString, format::AbstractString) = begin
    open(string(fname, ".", format), "w") do io
        run_graphviz(io, g, format=format)
    end
end
```

---

# Compositional scientific modeling

- Applied category theory promises to reduce complexity and boost engineering
  efficiency through _compositionality_
- Contemporary scientific models can be extremely large and complex, but they
  are usually built out of simpler pieces
- **Our goal**: Build ACT software that makes it easier to compose scientific
  models

---

# C-sets

**Recall**: Given a small category $\mathcal{C}$, a _$\mathcal{C}$-set_ is a functor $\mathcal{C} \to \mathbf{Set}$. <br/>
A $\mathcal{C}$-set is also called a "copresheaf on $\mathcal{C}$."

**Example**: The _schema for graphs_ is the category $\mathcal{C}$ generated by

```@eval
using TikzCDs
pic = TikzCD(L"""
  E \arrow[r, shift left=1, "\mathrm{src}"]
    \arrow[r, shift right=1, "\mathrm{tgt}"']
  & V
""")
save(SVG("schema-graphs"), pic)
```

![Schema for graphs](schema-graphs.svg# w-20pct)

A $\mathcal{C}$-set is then a _graph_, aka a "directed multigraph."

---

class: compact col-2

# C-sets in Catlab

In Catlab, a $\mathcal{C}$-set is a functor $\mathcal{C} \to \textbf{FinSet}$.

- Finite sets are identified with $\\{1,\dots,n\\}$ (we work in the skeleton of
  $\mathbf{FinSet}$)
- Functions are vectors of integers
- Preimages ("indexes") are stored for fast lookups, e.g. of edges incident to a
  vertex

From a software perspective, $\mathcal{C}$-sets are like in-memory databases.

<br>
<br>

```@example cset_graphs
using Catlab, Catlab.CategoricalAlgebra

@present SchemaGraphs(FreeSchema) begin
  V::Ob
  E::Ob
  src::Hom(E,V)
  tgt::Hom(E,V)
end

@acset_type Graph(SchemaGraphs,
                  index=[:src, :tgt])

g = Graph()
add_parts!(g, :V, 3)
add_parts!(g, :E, 2, src=[1,2], tgt=[2,3])
g
```

---

class: compact col-2

# Attributed C-sets

What about data outside of `FinSet{Int}`, say in $\mathbb{R}$?

- Edge weights in graphs
- Rates in Petri nets

For this, Catlab supports _attributed $\mathcal{C}$-sets_, which can be formalized in several ways:

- As functors $\mathcal{C} \to \mathbf{Set}$, like before, but fixed at certain
  objects
- As transformations out of a profunctor $\mathrm{Attr}: \mathcal{C} \to
  \mathsf{Data}$ (cf. [Schultz et al
  2017](http://www.tac.mta.ca/tac/volumes/32/16/32-16abs.html) on "algebraic
  databases")

```@example cset_graphs
@present SchemaWeightedGraphs <: SchemaGraphs begin
  Real::AttrType
  weight::Attr(E,Real)
end

@acset_type WeightedGraph(
  SchemaWeightedGraphs, index=[:src, :tgt])

g = WeightedGraph{Float64}()
add_parts!(g, :V, 2)
add_parts!(g, :E, 3, src=1, tgt=2,
           weight=[0.25, 0.5, 0.75])
g
```
